# Homebrew setup
if [ -x /opt/homebrew/bin/brew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif command -v brew >/dev/null 2>&1; then
    eval "$(brew shellenv)"
fi

# Ruby version manager (chruby)
# source /opt/homebrew/opt/chruby/share/chruby/chruby.sh
# source /opt/homebrew/opt/chruby/share/chruby/auto.sh
# chruby ruby-3.4.5

# PATH additions
export PATH="$HOME/Public/Projects/flutter/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.codeium/windsurf/bin:$PATH"
export PATH="$HOME/.antigravity/antigravity/bin:$PATH"

# Atuin shell history setup
if [ -f "$HOME/.atuin/bin/env" ]; then
    . "$HOME/.atuin/bin/env"
    
    # Shell-specific Atuin initialization
    if [ -n "$BASH_VERSION" ]; then
        # Bash-specific setup
        if [ -f "$HOME/.bash-preexec.sh" ]; then
            # shellcheck disable=SC1090
            source "$HOME/.bash-preexec.sh"
        fi
        if command -v atuin >/dev/null 2>&1; then
            eval "$(atuin init bash)"
        fi
    elif [ -n "$ZSH_VERSION" ]; then
        # Zsh-specific setup
        if command -v atuin >/dev/null 2>&1; then
            eval "$(atuin init zsh)"
        fi
    fi
fi

if command -v mise >/dev/null 2>&1; then
    if [ -n "$ZSH_VERSION" ]; then
        eval "$(mise activate zsh)"
    elif [ -n "$BASH_VERSION" ]; then
        eval "$(mise activate bash)"
    fi
fi

if [ -n "$ZSH_VERSION" ]; then
    # bindkey -v
elif [ -n "$BASH_VERSION" ]; then
    # set -o vi
fi

if [ -n "$ZSH_VERSION" ]; then
    # Kiro CLI post block. Keep at the bottom of this file.
    [[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh"
elif [ -n "$BASH_VERSION" ]; then
    # Kiro CLI post block. Keep at the bottom of this file.
    [[ -f "${HOME}/Library/Application Support/kiro-cli/shell/bashrc.post.bash" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/bashrc.post.bash"
fi

if [ -n "$BASH_VERSION" ]; then
    echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
    echo '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
    echo 'eval "$(pyenv init - bash)"' >> ~/.bashrc

    echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.profile
    echo '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.profile
    echo 'eval "$(pyenv init - bash)"' >> ~/.profile
elif [ -n "$ZSH_VERSION" ]; then
    echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.zprofile
    echo '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.zprofile
    echo 'eval "$(pyenv init - zsh)"' >> ~/.zprofile
fi

ebundle() {
  BUNDLE_IGNORE_CONFIG=1 \
  BUNDLE_PATH="$HOME/.bundle/gems" \
  command bundle "$@"
}

alias bundle=ebundle